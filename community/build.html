---
title: Qi4j Build System
layout: default
---
<div class="page-header">
    <h1>Build System</h1>
    <p class="lead">The Qi4j SDK is built using <a href="http://gradle.org">Gradle</a>.</p>
</div>
<div class="row-fluid">
    <div class="span2"></div>
    <div class="span8">
        <p>
            Qi4j community migrated away from Maven after several years of frustration, especially around release management,
            versioning and cross-module dependency resolution issues, in Feb 2011. The tool of choice is now Gradle, and it
            doesn't require any installation, there are gradlew and gradlew.bat in the root folder of the Qi4j SDK that will
            bootstrap Gradle if not done so already.
        </p>

        <h2>Versions</h2>
        <p>
            By default, the build system produces a "zero build". It means that there is no version assigned to the build, and
            a "0" is used in the produced artifacts. This is due to our disagreement (with Maven community) that the "next" version
            name/number is known prior to the release. This is in our opinion a delayed decision. To build a particular version,
            you specify a "version" property on the command-line, like
        </p>
        <pre>./gradlew -Dversion=2.0-FLAVOUR install</pre>
        <p>
            If a "version" property is not defined, the build system will refuse to make a release and upload.
        </p>

        <h2>Tasks</h2>
        <p>
            Gradle is very flexible, and we have defined (or in the process of defining) the following tasks (same as Ant's targets).
        </p>
        <dl>
            <dt>clean</dt>
            <dd>
                Clean up of all build output and restoring the code base to a fresh state.
            </dd>
            <dt>check</dt>
            <dd>
                This is the default build, which compiles the code and run the tests, but nothing else. A quick way to check that
                nothing broke.
            </dd>
            <dt>install</dt>
            <dd>
                Is roughly the same as Maven's install goal. It produces the test reports and javadocs and installs all the Jars into
                the local disk repository, for consumption by other applications.
            </dd>

            <dt>buildAll</dt>
            <dd>
                Produces all the archives, javadocs, manuals and website content. The output is generated to qi4j-sdk/build.
            </dd>
            <dt>release</dt>
            <dd>
                Uploads the release artifacts to the distribution servers and creates the release output into the
                qi4j-sdk/build/distributions directory.
            </dd>
        </dl>

        <h2>Configuration</h2>
        <p>
            Build System configuration is done through Gradle properties.
        </p>
        <p>
            This can be done in many ways, see
            <a href="http://gradle.org/docs/current/userguide/tutorial_this_and_that.html#sec:gradle_properties_and_system_properties">Gradle properties and system properties</a>.
        </p>

        <h2>Signing</h2>
        <p>
            Artifact signing is done using PGP. You need to provide Gradle the following properties
        </p>
        <pre>signing.keyId=FB751943
signing.password=foobar
signing.secretKeyRingFile=/home/foo/.gnupg/secring.gpg</pre>

        <h2>Artifact Upload</h2>
        <p>
            Artifact upload behavior depends on the version assigned to the build.
        </p>
        <p>
            By default RELEASES are signed, SNAPSHOTS are not.
            Signing can be turned on or off by setting the <code>uploadSigned</code> property to false.
        </p>
        <p>
            By default RELEASES must satisfy ReleaseSpecification, SNAPSHOT don't.
            ReleaseSpecification usage can be turned on or off by setting the <code>uploadReleaseSpec</code> property to false.
        </p>
        <p>
            By default RELEASES and SNAPHOTS are uploaded using WEBDAV.
            Used Wagon can be overriden by setting the <code>uploadWagon</code> property.
        </p>
        <p>
            By default RELEASES and SNAPSHOTS are uploaded to Cloudbees.
            Target repository can be overriden by setting the <code>uploadRepository</code> property.
        </p>
        <p>
            No username/password is provided by default.
            If needed set them using the <code>uploadUsername</code> and <code>uploadPassword</code> properties.
        </p>
        <p>
            For example here is how to deploy all artifacts as unsigned SNAPSHOTs to a given repository:
        </p>
        <pre>./gradlew uploadArchives -Dversion=2.0-SNAPSHOT -PuploadReleaseSpec=false \
-PuploadWagon=what:ever:wagon -PuploadRepository=http://what.ever.repository/url \
-PuploadUsername=foo -PuploadPassword=bar</pre>
        <p>
            And here is how to deploy a signed release to the local filesystem:
        </p>
        <pre>./gradlew uploadArchives -Dversion=2.0 -PuploadRepository=file:///path/to/local/repository</pre>
        <p>
            See the <a href="http://www.gradle.org/docs/current/userguide/maven_plugin.html#wagonLibs">Gradle documentation</a> about
            supported protocols.
        </p>

    </div>
    <div class="span2"></div>
</div>

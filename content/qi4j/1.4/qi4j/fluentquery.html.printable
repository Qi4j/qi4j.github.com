<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
   <head>
      <title>Fluent Query API    - www.qi4j.org</title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta name="robots" content="noindex, nofollow"  />
      <meta http-equiv="imagetoolbar" content="no" />
      <meta name="DC.Identifier" scheme="URL" content="http://www.qi4j.org" />
      <meta name="DC.Language" scheme="RFC1766" content="en" />
      <meta name="DC.Format" scheme="IMT" content="text/html" />
      <meta name="DC.Type" content="text" />
      <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/" />
      <style type="text/css" media="braille,embossed,handheld,print,projection,screen,speech,tty,tv">
         @import url(http://www.qi4j.org/2.6f43db4e123f11b40958000145/0/1964/SiteVision.css);
         @import url(../2.6f43db4e123f11b40958000145/auto-1-126/1964/SiteVision.css);
      </style>
      <!--[if IE]><link rel="stylesheet" type="text/css" media="screen" href="/sitevision-ie.css" /><![endif]-->
      <link rel="stylesheet" type="text/css" media="screen" href="../sitevision/ajax/jquery/plugins/fancybox/jquery.fancybox-1.3.1-mod.css" />
      <!--[if IE]><link rel="stylesheet" type="text/css" media="screen" href="/sitevision/ajax/jquery/plugins/fancybox/jquery.fancybox-1.3.1-ie.css" /><![endif]-->
      <link rel="stylesheet" type="text/css" media="screen" href="../sitevision/ajax/jquery/plugins/rating/jquery.rating.css" />
      <script type="text/javascript" src="../sitevision/util/externallinks.js"></script>
      <script type="text/javascript" src="../sitevision/ajax/jquery/jquery-1.4.2.min.js"></script>
      <script type="text/javascript" src="../sitevision/ajax/jquery/plugins/rating/jquery.rating.js"></script>
      <script type="text/javascript" src="../sitevision/ajax/jquery/plugins/metadata/jquery.metadata.min.js"></script>
      <script type="text/javascript">
         var $svjq = jQuery.noConflict();
      </script>
      <script type="text/javascript" src="../sitevision/ajax/jquery/plugins/pngfix/jquery.pngFix.pack.js"></script>
      <script type="text/javascript" src="../sitevision/ajax/jquery/plugins/fancybox/jquery.fancybox-1.3.1.pack.js"></script>
   </head>

   <body class="c0">



<div  id="svid10_6f43db4e123f11b409580001291"><div class="c1" id="svid10_6f43db4e123f11b409580002977">
<div class="c2" id="svid10_6f43db4e123f11b409580004453">
<div id="svid10_6f43db4e123f11b409580004781">
<div class="c3" id="svid12_6f43db4e123f11b409580001845"><div id="Qi4jlogo"><!-- Qi4j logo --></div><a title="Return to Qi4j homepage" href="2.html"><img alt="Qi4j" class="c4" src="../images/18.6f43db4e123f11b409580003681/logo-box.jpg" /></a></div>
<div class="c5" id="svid12_6f43db4e123f11b409580004581"><div id="Multilevellink1"><!-- Multilevellink 1 --></div>

<ul class="c6">
  <li  class="breadcrumb c7">      
          
        <a href="2.html" title="" class="breadcrumb c8" >Home</a>
    </li>
  <li  class="breadcrumb c7"> <img alt="" src="../images/18.6f43db4e123f11b409580002965/breadcrumb.gif" class="c48" />       
          
        <a href="15.html" title="" class="breadcrumb c48" >Documentation</a>
    </li>
  <li  class="breadcrumb c7"> <img alt="" src="../images/18.6f43db4e123f11b409580002965/breadcrumb.gif" class="c48" />       
          
        <a href="31.html" title="" class="breadcrumb c48" >Qi4j - The Complete Manual</a>
    </li>
  <li  class="breadcrumb c7"> <img alt="" src="../images/18.6f43db4e123f11b409580002965/breadcrumb.gif" class="c48" />       
          
        <a href="query.html" title="" class="breadcrumb c48" >Query API</a>
    </li>
  <li  class="breadcrumb c7"> <img alt="" src="../images/18.6f43db4e123f11b409580002965/breadcrumb.gif" class="c48" />         <span class="c48" >Fluent Query API</span>
    </li>
</ul>
</div>
<div class="c9" id="svid12_6f43db4e123f11b409580004814"><div id="Search"><!-- Search --></div><form method="get" action="158.html" class="c19">
   <div>
      <label for="search12_6f43db4e123f11b409580004814" class="svhidden">Search</label>
      <input id="search12_6f43db4e123f11b409580004814" class="search c8"  type="text" name="query" size="20" value="Search here" onclick="if (this.value = 'Search here') this.value='';" onkeypress="" />
      <input type="submit" class="search c8" name="submit" value="Go"  />
   </div>
</form>
</div>
<div class="c10" id="svid12_6f43db4e123f11b409580004806"><div id="Printversion"><!-- Printversion --></div>

  <a class="breadcrumb" title="Printer friendly version" rel="nofollow" href="fluentquery.html.printable">

  Print |
</a></div>
<div class="c11"></div>
</div>
</div>
<div class="ielayoutfix c12"  id="svid10_6f43db4e123f11b409580004723">
<div id="svid94_6f43db4e123f11b40958000836" ><div id="svid10_6f43db4e123f11b409580003677">
<div class="c13" id="svid10_6f43db4e123f11b409580004666"><div class="c14" id="svid12_6f43db4e123f11b409580004536">
<div id="Expandingmenu"><!-- Expanding menu --></div><table summary="" cellspacing="1" cellpadding="0" class="c15">
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="17.html" class="navigation" title="Community">Community</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
            </td>
   <td class="c15">
                        <a href="9.html" class="navigation" title="News">News</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="21.html" class="navigation" title="Licensing">Licensing</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="downloads.html" class="navigation" title="Download">Download</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="introduction.html" class="navigation" title="Introduction to Qi4j">Introduction to Qi4j</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="146.html" class="navigation" title="Tutorials &amp; HowTOs">Tutorials &amp; HowTOs</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003861/navi-expand-no.gif" />
              </td>
   <td class="c15">
                        <a href="15.html" class="navigation" title="Documentation">Documentation</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c50">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003861/navi-expand-no.gif" />
              </td>
   <td class="c15">
                        <a href="31.html" class="newsxmm" title="Qi4j - The Complete Manual">Qi4j - The Complete Manual</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c55">
            </td>
   <td class="c15">
                        <a href="32.html" class="newsxmm" title="Overview">Overview</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c55">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="209.html" class="newsxmm" title="Composition">Composition</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c55">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="70.html" class="newsxmm" title="Assembly">Assembly</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c55">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="35.html" class="newsxmm" title="Core System API">Core System API</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c55">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="73.html" class="newsxmm" title="Runtime Bootstrap API">Runtime Bootstrap API</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c55">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="36.html" class="newsxmm" title="Persistence">Persistence</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c55">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003861/navi-expand-no.gif" />
              </td>
   <td class="c15">
                        <a href="query.html" class="newsxmm" title="Query API">Query API</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c56">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003861/navi-expand-no.gif" />
              </td>
   <td class="c15">
                        <a href="fluentquery.html" class="navigationxxactivex" title="Fluent Query API">Fluent Query API</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c57">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="367.html" class="newsxmm" title="Factory Methods">Factory Methods</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c57">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="352.html" class="newsxmm" title="Operators">Operators</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c56">
            </td>
   <td class="c15">
                        <a href="377.html" class="newsxmm" title="Named Native Queries">Named Native Queries</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c55">
            </td>
   <td class="c15">
                        <a href="43.html" class="newsxmm" title="Indexing">Indexing</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c55">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="33.html" class="newsxmm" title="Concepts">Concepts</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c55">
            </td>
   <td class="c15">
                        <a href="42.html" class="newsxmm" title="References">References</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c50">
            </td>
   <td class="c15">
                        <a href="139.html" class="newsxmm" title="Extensions">Extensions</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c49">
 <tr>
  <td class="c50">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="226.html" class="newsxmm" title="Libraries">Libraries</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="333.html" class="navigation" title="Sandbox">Sandbox</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
            </td>
   <td class="c15">
                        <a href="336.html" class="navigation" title="Samples">Samples</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
                  <img class="c18" alt="" src="../images/18.6f43db4e123f11b409580003636/navi-expand.gif" />
              </td>
   <td class="c15">
                        <a href="sponsors.html" class="navigation" title="Sponsors">Sponsors</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
            </td>
   <td class="c15">
                        <a href="support.html" class="navigation" title="Support">Support</a>
           </td>
  </tr>
</table>
</td></tr>
<tr><td>
   <table summary="" class="c16">
 <tr>
  <td class="c17">
            </td>
   <td class="c15">
                        <a href="288.html" class="navigation" title="Latest Changes">Latest Changes</a>
           </td>
  </tr>
</table>
</td></tr>

</table>
</div>
<div class="c20" id="svid12_6f43db4e123f11b409580004771">
<div id="Text"><!-- Text --></div></div>
<div class="c29" id="svid12_58e87b6312cf378e76d8000904">
<div id="HTML"><!-- HTML --></div>


</div>
</div>
<div class="c5" id="svid10_6f43db4e123f11b409580004744"><div id="svid94_6f43db4e123f11b40958000912" ><div class="c53" id="svid10_6f43db4e123f11b409580004222">
<!-- Page content starts here --><div class="pagecontent" id="svid94_38c6b4cb1249ac3d5d58000413" ><div id="Centercolumn"><!-- Center column --></div><div class="c32" id="svid12_38c6b4cb1249ac3d5d58000414">
<div id="Heading"><!-- Heading --></div><div id="h-BuildingaFluentQuery" class="sv-inline"><!-- Building a Fluent Query --></div><h1 class="heading">Building a Fluent Query</h1></div>
<div class="c52"></div>
<div id="svid12_38c6b4cb1249ac3d5d58000415">
<div id="Content"><!-- Content --></div><span class="normal">Queries in Qi4j can either be created from the Fluent Query API, or looked up by name from a list of native queries. In both cases, the application code is intended to become indexing subsystem-independent, but </span><a class="normal" title="Link to Named Native Queries." href="377.html">Named Native Queries</a><span class="normal"> requires that the bootstrap code is tailored to the indexing subsystem put in place.</span><p><!-- empty --></p><div id="h-IntroductiontoFluentQueryAPI" class="sv-inline"><!-- Introduction to Fluent Query API --></div><h2 class="subheading">Introduction to Fluent Query API</h2><br /><span class="normal">The Fluent Query API is based around the concept that you write the query expression using Java, and the intention of the query expressed will be translated into the underlying query language that is currently in use. Let's look at a simple example;</span></div>
<div class="c52"></div>
<div class="c73" id="svid12_24b706fd12696de71a7800023">
<div id="Text-0"><!-- Text --></div><span class="javaxcode">import static org.qi4j.api.query.QueryExpressions.</span><span class="javaxcode"><strong><em>eq</em></strong></span><span class="javaxcode">;</span><br /><span class="javaxcode">import static org.qi4j.api.query.QueryExpressions.</span><span class="javaxcode"><strong><em>templateFor</em></strong></span><span class="javaxcode">;</span><p><span class="javaxcode">public class PersonRepositoryMixin</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;implements PersonRepository</span><br /><span class="javaxcode">{</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;@Structure UnitOfWorkFactory uowf;</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;@Structure QueryBuilderFactory qbf;</span></p><p><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;public Query&lt;Person&gt; findPersonsByOccupation( String occupation )</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;{</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnitOfWork uow = uowf.currentUnitOfWork();</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueryBuilder&lt;Person&gt; qb = qbf.newQueryBuilder( Person.class );</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Person template = templateFor( Person.class );</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return qb</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.where( </span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq( template.occupation(), occupation ) )</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.newQuery( uow );</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br /><span class="javaxcode">}</span></p></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a7800024">
<div id="Text1"><!-- Text 1 --></div><span class="normal">In the above example, we are asking a repository to provide us with a query that can be used to retrieve the Person instances that has the </span><span class="javaxcode"><strong><em>occupation</em></strong></span><span class="normal"> property set to the given string. The </span><span class="javaxcode"><strong><em>template</em></strong></span><span class="normal"> is a representation of the queried entities, so that we can indicate what those values should be. In this case, we are using the same type as the returned type, but if for instance we have properties in private mixins that we want to query about, we can use those private mixin types as templates.</span><p><span class="normal">So how do we use this?</span></p></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a7800027">
<div id="Text3"><!-- Text 3 --></div><div id="h-ExecutingaQuery" class="sv-inline"><!-- Executing a Query --></div><h2 class="subheading">Executing a Query</h2></div>
<div class="c52"></div>
<div class="c73" id="svid12_24b706fd12696de71a7800025">
<div id="Text2"><!-- Text 2 --></div><span class="javaxcode">// First of all we obtain the query</span><br /><span class="javaxcode">PersonRepository repo = ...;</span><br /><span class="javaxcode">Query&lt;Person&gt; query = repo.findPersonsByOccupation( "ballet dancer" );</span><p><span class="javaxcode">// When the iterator() method is called in the Query, </span><br /><span class="javaxcode">// the query is executed.</span><br /><span class="javaxcode">for( Person person : query )</span><br /><span class="javaxcode">{</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;// take care of the result.</span><br /><span class="javaxcode">}</span></p></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a78000873">
<div id="Text4"><!-- Text 4 --></div><span class="normal">The query in the above example is not executed until the </span><span class="javaxcode">iterator() </span><span class="normal">method is called on the Query instance, which happens behind the scenes in the </span><span class="javaxcode">for()</span><span class="normal"> loop. </span></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a78000883">
<div id="Text11"><!-- Text 11 --></div><div id="h-Pagination" class="sv-inline"><!-- Pagination --></div><h2 class="subheading">Pagination</h2></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a78000884">
<div id="Text12"><!-- Text 12 --></div><span class="normal">If we want to paginate our query results, we call the </span><span class="javaxcode">firstResult() </span><span class="normal">and </span><span class="javaxcode">maxResults()</span><span class="normal"> methods on the </span><span class="javaxcode">Query</span><span class="normal">, prior to making the </span><span class="javaxcode">iterator()</span><span class="normal"> call.</span></div>
<div class="c52"></div>
<div class="c73" id="svid12_24b706fd12696de71a78000886">
<div id="Text14"><!-- Text 14 --></div><span class="javaxcode">// We can do paging operations</span><br /><span class="javaxcode">query.maxResults().set( 100 );</span><p><span class="javaxcode">query.firstResult().set( 0 );</span><br /><span class="javaxcode">Iterator firstPage = query.iterator();</span></p><p><span class="javaxcode"> // do something...</span></p><p><span class="javaxcode">query.firstResult().set( 100 );</span><br /><span class="javaxcode">Iterator secondPage = query.iterator();</span></p><p><span class="javaxcode"> // do something...</span></p><p><span class="javaxcode">query.firstResult().set( 200 );</span><br /><span class="javaxcode">Iterator thirdPage = query.iterator();</span></p></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a78000885">
<div id="Text13"><!-- Text 13 --></div><span class="normal">Here we retrieve the result in chunks of 100 items per page. The </span><span class="javaxcode">firstResult() </span><span class="normal">method is zero-indexed, and has the default value of zero. The </span><span class="javaxcode">maxResults()</span><span class="normal"> method has 'no limit' as the default.</span></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a78000874">
<div id="Text5"><!-- Text 5 --></div><div id="h-Ordering" class="sv-inline"><!-- Ordering --></div><h2 class="subheading">Ordering</h2></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a78000875">
<div id="Text6"><!-- Text 6 --></div><span class="normal">Queries often need to be ordered/sorted according to one or more fields. Qi4j supports this in the Fluent Query API via the </span><span class="javaxcode">orderBy() </span><span class="normal">method on the </span><span class="javaxcode">Query</span><span class="normal"> interface. The method takes one or more </span><span class="javaxcode">OrderBy</span><span class="normal"> templates as input, and the ordering will be on those fields, with the highest priority first. Let's look at an example, as it will make things clearer. Let's say that we want to order the above query by surname and firstname.</span></div>
<div class="c52"></div>
<div class="c73" id="svid12_24b706fd12696de71a78000876">
<div id="QueryOrdercode"><!-- Query Order code --></div><span class="javaxcode">import static org.qi4j.api.query.QueryExpressions.</span><span class="javaxcode"><strong>orderBy</strong></span><span class="javaxcode">;</span><p><span class="javaxcode">QueryBuilder&lt;Person&gt; qb = qbf.newQueryBuilder( Person.class );</span><br /><span class="javaxcode">Person template = templateFor( Person.class );</span><br /><span class="javaxcode">Query query = qb.where( </span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq( template.occupation(), occupation ) )</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.newQuery( uow );</span></p><p><span class="javaxcode">query.orderBy( orderBy( template.lastName()), </span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orderBy( template.firstName()) </span><br /><span class="javaxcode">);</span></p></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a78000877">
<div id="Text7"><!-- Text 7 --></div><span class="normal">The QueryExpressions.orderBy() method also has a Order argument, if needed. Default Order is ascending, but if the opposite is needed, the do the following;</span></div>
<div class="c52"></div>
<div class="c73" id="svid12_24b706fd12696de71a78000878">
<div id="QueryOrderDescendingcode"><!-- Query Order Descending code --></div><span class="javaxcode">query.orderBy( orderBy( template.lastName(), OrderBy.Order.DESCENDING) );</span></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a78000879">
<div id="Text8"><!-- Text 8 --></div><div id="h-Crosstypequerying" class="sv-inline"><!-- Cross type querying --></div><h2 class="subheading">Cross type querying</h2></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a78000880">
<div id="Text9"><!-- Text 9 --></div><span class="normal">In the above example, we had the same type for both the return value as well as the interface used for the query parameters. Since Qi4j has a very strong encapsulation of mixins, it is often more common to query on the internal state of the composite, and return the composite instance being matched. It should be very obvious from the above code what goes where.</span><br /><span class="normal">Let's say we have a role called Trusted implemented by many types of things, such as people, vehicles and software. Now imagine we want to search for the Trusted role, which has a firstName of "John".</span></div>
<div class="c52"></div>
<div class="c73" id="svid12_24b706fd12696de71a78000881">
<div id="Crosstypequerycode"><!-- Crosstype query code --></div><span class="javaxcode">QueryBuilder&lt;Trusted&gt; qb = qbf.newQueryBuilder( Trusted.class );</span><br /><span class="javaxcode">Person template = templateFor( Person.class );</span><br /><span class="javaxcode">Query query = qb.where( </span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq( template.firstName(), "John" ) )</span><br /><span class="javaxcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.newQuery( uow );</span></div>
<div class="c52"></div>
<div id="svid12_24b706fd12696de71a78000882">
<div id="Text10"><!-- Text 10 --></div><span class="normal">The interesting part of the above is that not all Trusted entities are also of type Person. Thanks to Qi4j's separation of Indexing &amp; Query from Storage &amp; Retrieval, it is possible to make these kind of mixed type queries, and not forcing the same structure for all entities of the same type. This is very similar to how search engines work for the world-wide web, all sites are different, yet they can be indexed and queried.</span><p><span class="normal">On top of that, the templateFor() method can be used to query private mixins that are not visible to the outside of the composite.</span></p></div>
</div><!-- Page content stops here --></div>
</div></div>
<div class="c11"></div>
</div>
</div></div>
<div class="c44" id="svid10_6f43db4e123f11b409580004680">
<div class="c45" id="svid12_6f43db4e123f11b409580004800">
<div id="TrademarkNotice"><!-- Trademark Notice --></div><br /><span class="normal">Qi4j and the Qi4j logo are trademarks of Richard Öberg, Niclas Hedhman and the members of the Qi4j Core Team. See </span><a class="normal" title="Link to licensing." href="21.html">Qi4j licensing</a><span class="normal"> for more information.</span></div>
<div class="c46" id="svid12_6f43db4e123f11b409580004768">
<div id="Poweredby"><!-- Powered by --></div><span class="normal">Powered by </span><a class="normal" title="SiteVision official page (external link)" href="http://www.sitevision.se/">SiteVision<img alt="external link" src="../sitevision/util/images/externallink.png" class="c39" /></a><span class="normal">.</span></div>
<div class="c47" id="svid12_6f43db4e123f11b409580004801">
<div id="HTML-0"><!-- HTML --></div><script>
</script>
<script type="text/javascript">


</script>
</div>
</div>
</div>
</div>
<script type="text/javascript">parent.print();</script><noscript><!-- Starts a printout of this page --></noscript>


  
 



   </body>
</html>